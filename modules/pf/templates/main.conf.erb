
# Do not packet filter anything on loopback device
set skip on lo0

# Setup antispoofing
antispoof quick for <%= @iface %>

# Set default rule which can be overridden by the nodescope var $fw_allow_all
<% if @fw_allow_all -%>
pass all
<% else -%>
block all
<% end -%>

# Make an exception for all outgoing packets
pass out all

# Allow all icmp packets
pass in quick inet proto icmp all icmp-type echoreq

# See bug 1401601 and 1409349
# Just in case the state tables fail to allow a dhcp exchange
# Allow all dhcp packets
pass in quick inet proto udp from any port 67 to any port 68

# Include tables
include "<%= @pf_dir -%>/tables.conf"

# Include rules
include "<%= @pf_dir -%>/rules.conf"

# Log all ssh that ends up denied
block in log quick on <%= @iface %> inet proto tcp from any to any port 22

